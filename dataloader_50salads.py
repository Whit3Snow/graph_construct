import random

high_level_nodes = ["cut_and_mix_ingredients", "prepare_dressing", "serve_salad"]

class Dataloader():
    def __init__(self, dataset):
        self.dataset = dataset

    def get_actions(self):
        data_list = self.get_data_list()

        action_set = open("data/{}/actions.txt".format(self.dataset), 'r').read().splitlines()

        all_action_list = []
        for idx, data_file in enumerate(data_list):
            annotation_file = "data/{}/labels/{}".format(self.dataset, data_file)
            lines = open(annotation_file, 'r').read().splitlines()

            all_actions = []
            for line in lines:
                start_time, _, action_name = line.split(' ')
                if action_name not in high_level_nodes:
                    all_actions.append([start_time, action_name])
            all_actions = sorted(all_actions, key=lambda x : int(x[0]))

            refined_actions = []
            for _, action_name in all_actions:
                action_split = action_name.split('_')
                if action_split[-1] in ['core', 'prep', 'post']:
                    action_name = "_".join(action_split[:-1])
                if len(refined_actions) == 0 or refined_actions[-1] != action_name:
                    refined_actions.append(action_name) 
            refined_actions.append("done")
            
            all_action_list.append(refined_actions)

        return all_action_list, data_list, action_set

    def get_data_list(self):
        # GOOD
        # data_list = ["13-1", "17-2", "09-1"]
        # data_list = ["07-1", "13-1", "15-2"]
        # data_list = ["07-1", "13-1", "15-2", "13-1", "17-2", "09-1"]

        # NOT DONE
        # data_list = ['01-1', '04-2', '05-2']
        # data_list = ['27-1', '06-2', '23-1', '19-1', '20-1', '25-2', '15-1', '01-1', '24-1', '12-1', '18-1', '01-2', '17-2', '04-2', '14-1', '25-1', '02-1', '15-2', '16-2', '03-2']
        # data_list = ['22-2', '03-2', '14-2', '06-2', '23-1', '15-2', '04-2', '03-1', '21-2', '19-2', '14-1', '16-1', '07-1', '17-2', '20-2', '26-2', '09-1', '06-1', '21-1', '02-2']
        # data_list = ['13-2', '09-2', '21-2', '27-1', '23-2', '03-1', '10-1', '13-1', '15-1', '02-1', '19-2', '19-1', '23-1', '05-1', '08-1', '06-2', '24-2', '04-2', '22-2', '05-2']

        # WORST
        # data_list = ['18-1', '26-2', '26-1']
        # data_list = ['26-2', '26-1', '18-1']
        # data_list = ['26-2', '26-1']

        # WHY BLACK IS ADDED
        data_list = ['26-2', '26-1', '04-2', '16-1', '12-2', '07-2', '07-1', '13-2', '06-2', '16-2', '12-1', '11-1', '26-2', '04-1', '26-1', '14-2', '03-1', '24-1', '21-1', '27-1', '22-1']

        # data_list = ['25-1', '20-1', '06-1', '20-2', '16-2', '01-1', '08-2', '01-2', '18-1', '10-1', '05-2', '07-2', '12-1', '02-2', '13-1', '23-2', '15-1', '09-1', '07-1', '22-1', '04-2', '14-1', '27-1', '02-1', '12-2', '13-2', '10-2', '17-2', '05-1', '27-2']
        # data_list = ['25-1', '20-1', '06-1', '20-2', '16-2', '08-2', '01-2', '18-1', '10-1', '05-2', '07-2', '12-1', '02-2', '13-1', '23-2', '15-1', '09-1', '07-1', '22-1', '04-2', '14-1', '27-1', '02-1', '12-2', '13-2', '10-2', '17-2', '05-1', '27-2']

        # data_list = ['09-1', '14-1', '20-2', '06-1', '21-1', '01-1', '24-2', '02-2', '08-1', '04-1', '25-1', '07-1', '03-2', '13-2', '11-2', '19-1', '15-2', '05-2', '15-1', '18-2']
        # data_list = ['09-1', '14-1', '20-2', '06-1', '21-1', '24-2', '02-2', '08-1', '04-1', '25-1', '07-1', '03-2', '13-2', '11-2', '19-1', '15-2', '05-2', '15-1', '18-2']

        # data_list = ['18-1', '23-1', '25-2', '04-1', '06-1', '11-1', '09-2', '24-1', '26-1', '02-2', '19-2', '05-1', '27-2', '15-1', '10-2', '08-2', '18-2', '21-2', '20-2', '12-2']
        # data_list = ['01-1', '02-1', '17-2', '26-1', '03-2', '18-2', '01-2', '20-2', '09-2', '13-2', '25-1', '16-1', '22-2', '08-1', '15-1', '24-1', '20-1', '12-2', '21-1', '06-1']
        # data_list = ['27-1', '13-2', '15-1', '27-2', '16-2', '08-1', '22-1', '06-1', '16-1', '03-2', '07-2', '05-2', '09-2', '23-1', '05-1', '08-2', '14-2', '24-2', '03-1', '18-1']
        # data_list = ['09-1', '22-2', '25-1', '23-1', '08-1', '06-2', '10-2', '18-1', '21-2', '15-1', '01-2', '03-1', '04-2', '05-1', '16-1', '20-1', '17-2', '12-1', '14-2', '21-1']
        # data_list = ['25-2', '03-2', '22-1', '12-2', '05-2', '27-1', '15-2', '10-1', '09-1', '12-1', '13-2', '04-2', '14-2', '18-1', '17-1', '08-1', '20-2', '19-2', '13-1', '21-2']
        # data_list = ['09-1', '16-2', '07-2', '24-1', '06-1', '01-2', '09-2', '18-2', '20-1', '25-2', '16-1', '19-1', '10-2', '18-1', '04-2', '21-2', '26-1', '11-2', '25-1', '26-2']
        # data_list = ['17-1', '17-2', '09-2', '03-1', '01-1', '08-2', '11-1', '15-2', '10-1', '26-2', '16-2', '22-1', '12-2', '20-1', '12-1', '19-2', '26-1', '02-1', '06-2', '04-1']

        # data_list = ["{:02}-{}".format(i, j) for i in range(1,28) for j in [1, 2]]
        # random.shuffle(data_list)
        # data_list = data_list[:20]

        print(data_list)

        data_list = [data_num + '-activityAnnotation.txt' for data_num in data_list]

        return data_list